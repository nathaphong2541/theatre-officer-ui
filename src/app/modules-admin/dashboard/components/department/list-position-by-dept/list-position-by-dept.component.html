<div class="p-4 sm:p-6">
    <!-- Header -->
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-xl sm:text-2xl font-semibold text-slate-900">
                Position
            </h1>
            <p class="text-sm text-slate-500 mt-1">
                รายการตำแหน่งของ Department : {{ this.department.nameEn }}
            </p>
        </div>

        <div class="flex gap-2">
            <a routerLink="/admin/master/departments"
                class="inline-flex items-center gap-2 rounded-xl border px-4 py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-50">
                <i class="fa-solid fa-arrow-left"></i>
                กลับ
            </a>

            <button type="button" (click)="openCreate()"
                class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-emerald-700">
                <i class="fa-solid fa-plus"></i>
                เพิ่มตำแหน่ง
            </button>
        </div>
    </div>

    <!-- Alerts -->
    <div *ngIf="error" class="mt-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
        {{ error }}
    </div>

    <div *ngIf="loading" class="mt-4 rounded-xl border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-700">
        กำลังโหลด...
    </div>

    <!-- Table -->
    <div class="mt-4 rounded-2xl border bg-white shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-[800px] w-full text-left text-sm">
                <thead class="bg-slate-50 text-slate-600">
                    <tr>
                        <th class="px-4 py-3 font-semibold w-[80px]">#</th>
                        <th class="px-4 py-3 font-semibold">ชื่ออังกฤษ</th>
                        <th class="px-4 py-3 font-semibold">ชื่อไทย</th>
                        <th class="px-4 py-3 font-semibold">รายละเอียด</th>
                        <th class="px-4 py-3 font-semibold text-right w-[220px]">Actions</th>
                    </tr>
                </thead>

                <tbody class="divide-y">
                    <tr *ngFor="let p of positions; let i = index; trackBy: trackById" class="hover:bg-slate-50/70">
                        <td class="px-4 py-3">{{ page * size + i + 1 }}</td>
                        <td class="px-4 py-3">{{ p.nameEn }}</td>
                        <td class="px-4 py-3 font-medium">{{ p.nameTh }}</td>
                        <td class="px-4 py-3 text-slate-500">{{ p.description || '-' }}</td>
                        <td class="px-4 py-3">
                            <div class="flex justify-end gap-2">
                                <button type="button" (click)="openEdit(p)"
                                    class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50">
                                    <i class="fa-regular fa-pen-to-square"></i> แก้ไข
                                </button>

                                <button type="button" (click)="remove(p)"
                                    class="inline-flex items-center gap-2 rounded-xl border border-red-200 bg-white px-3 py-2 text-sm font-medium text-red-600 hover:bg-red-50">
                                    <i class="fa-regular fa-trash-can"></i> ลบ
                                </button>
                            </div>
                        </td>
                    </tr>

                    <tr *ngIf="!loading && positions.length === 0">
                        <td colspan="4" class="px-4 py-12 text-center text-slate-500">
                            ไม่พบข้อมูล
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="border-t px-4 py-3 flex flex-wrap items-center justify-between gap-2">
            <div class="text-sm text-slate-600">
                ทั้งหมด {{ total }} รายการ
            </div>

            <div class="flex items-center gap-2">
                <button (click)="prevPage()" [disabled]="page === 0 || loading"
                    class="rounded-full border px-4 py-2 text-sm disabled:opacity-50">
                    ก่อนหน้า
                </button>

                <span class="text-sm">
                    หน้า {{ page + 1 }} / {{ totalPages }}
                </span>

                <button (click)="nextPage()" [disabled]="page >= totalPages - 1 || loading"
                    class="rounded-full border px-4 py-2 text-sm disabled:opacity-50">
                    ถัดไป
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div *ngIf="modalOpen" class="fixed inset-0 z-50">
    <div class="absolute inset-0 bg-black/50" (click)="closeModal()"></div>

    <div class="relative mx-auto flex min-h-full max-w-2xl items-center justify-center p-4">
        <div class="w-full rounded-2xl bg-white shadow-xl">
            <div class="flex items-center justify-between border-b border-slate-100 px-5 py-4">
                <h2 class="text-base sm:text-lg font-semibold text-slate-900">
                    {{ mode === 'create' ? 'เพิ่มตำแหน่ง' : 'แก้ไขตำแหน่ง' }}
                </h2>
                <button type="button" (click)="closeModal()"
                    class="rounded-xl p-2 text-slate-500 hover:bg-slate-100 hover:text-slate-700">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <form class="px-5 py-4" [formGroup]="form" (ngSubmit)="save()">
                <div class="grid gap-4 sm:grid-cols-2">
                    <div class="sm:col-span-1">
                        <label class="block text-sm font-medium text-slate-700">
                            ชื่ออังกฤษ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" formControlName="nameEn" placeholder="เช่น Actor"
                            class="mt-2 w-full rounded-xl border border-slate-200 px-3 py-2.5 text-sm outline-none focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10" />
                        <p *ngIf="form.controls.nameEn.touched && form.controls.nameEn.invalid"
                            class="mt-1 text-xs text-red-600">กรุณากรอกชื่ออังกฤษ</p>
                    </div>

                    <div class="sm:col-span-1">
                        <label class="block text-sm font-medium text-slate-700">
                            ชื่อไทย <span class="text-red-500">*</span>
                        </label>
                        <input type="text" formControlName="nameTh" placeholder="เช่น นักแสดง"
                            class="mt-2 w-full rounded-xl border border-slate-200 px-3 py-2.5 text-sm outline-none focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10" />
                        <p *ngIf="form.controls.nameTh.touched && form.controls.nameTh.invalid"
                            class="mt-1 text-xs text-red-600">กรุณากรอกชื่อไทย</p>
                    </div>

                    <!-- ✅ แสดง department ที่ผูกอยู่ (read-only) -->
                    <div class="sm:col-span-2">
                        <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                            Department: <b>{{ department.nameTh }}</b>
                            <span *ngIf="department?.nameEn"> ({{ department.nameEn }})</span>
                            <span class="text-slate-500"> • ID: {{ departmentId }}</span>
                        </div>
                    </div>

                    <div class="sm:col-span-2">
                        <label class="block text-sm font-medium text-slate-700">รายละเอียด</label>
                        <textarea rows="3" formControlName="description" placeholder="รายละเอียดเพิ่มเติม"
                            class="mt-2 w-full rounded-xl border border-slate-200 px-3 py-2.5 text-sm outline-none focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10"></textarea>
                    </div>
                </div>

                <div class="mt-5 flex flex-col-reverse gap-2 sm:flex-row sm:justify-end">
                    <button type="button" (click)="closeModal()"
                        class="w-full sm:w-auto rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-50">
                        ยกเลิก
                    </button>

                    <button type="submit" [disabled]="loading"
                        class="w-full sm:w-auto rounded-xl bg-emerald-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:opacity-60">
                        <i class="fa-regular fa-floppy-disk mr-2"></i>
                        บันทึก
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>